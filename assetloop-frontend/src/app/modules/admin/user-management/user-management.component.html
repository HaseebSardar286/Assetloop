<div class="d-flex flex-column vh-100">
  <app-header (logout)="onLogout()"></app-header>
  <div class="d-flex flex-grow-1">
    <app-admin-sidebar></app-admin-sidebar>
    <main class="flex-grow-1 p-4 bg-light">
      <h2 class="mb-4">User Management</h2>
      <!-- Search Card -->
      <div class="card mb-4">
        <div class="card-header">Search Users</div>
        <div class="card-body">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              placeholder="Search by name, email, or role..."
              [(ngModel)]="searchTerm"
              (input)="searchUsers()"
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              (click)="clearSearch()"
            >
              Clear
            </button>
          </div>
        </div>
      </div>
      <!-- Users Card -->
      <div class="card">
        <div class="card-header">
          All Users ({{ filteredUsers.length || 0 }})
        </div>
        <div class="card-body">
          <!-- Loading Spinner -->
          <div *ngIf="loading" class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading users...</p>
          </div>
          <table class="table table-striped" *ngIf="!loading">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of paginatedUsers">
                <td>{{ user._id }}</td>
                <td>
                  {{ user.firstName || "N/A" }}
                  {{ user.middleName ? user.middleName + " " : ""
                  }}{{ user.lastName || "N/A" }}
                </td>
                <td>{{ user.email || "N/A" }}</td>
                <td>
                  <span
                    class="badge"
                    [ngClass]="{
                      'bg-success': user.role.toLowerCase() === 'admin',
                      'bg-info': user.role.toLowerCase() === 'owner',
                      'bg-primary': user.role.toLowerCase() === 'renter'
                    }"
                  >
                    {{ user.role ? (user.role | titlecase) : "N/A" }}
                  </span>
                </td>
                <td>
                  <button
                    class="btn btn-info btn-sm me-2"
                    [routerLink]="['/admin/users/details', user._id]"
                  >
                    <fa-icon [icon]="faEye" class="btn-primary"></fa-icon>
                  </button>
                  <button
                    class="btn btn-danger btn-sm"
                    (click)="deleteUser(user._id)"
                  >
                    <fa-icon [icon]="faTrash" class="btn-primary"></fa-icon>
                  </button>
                </td>
              </tr>
              <tr *ngIf="paginatedUsers.length === 0">
                <td colspan="5" class="text-center text-muted">
                  No users found
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Pagination -->
          <nav aria-label="Users pagination" *ngIf="totalPages > 1">
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  href="#"
                  >Previous</a
                >
              </li>
              <li
                class="page-item"
                *ngFor="let page of [].constructor(totalPages); let i = index"
                [class.active]="currentPage === i + 1"
              >
                <a class="page-link" (click)="changePage(i + 1)" href="#">{{
                  i + 1
                }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPages"
              >
                <a
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  href="#"
                  >Next</a
                >
              </li>
            </ul>
          </nav>
          <!-- Error Message -->
          <div *ngIf="error" class="alert alert-danger mt-4" role="alert">
            {{ error }}
            <button
              type="button"
              class="btn-close"
              (click)="error = null"
            ></button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

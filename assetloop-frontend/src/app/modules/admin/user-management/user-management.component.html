<div class="d-flex flex-column vh-100">
  <app-header (logout)="onLogout()"></app-header>
  <div class="d-flex flex-grow-1">
    <app-admin-sidebar></app-admin-sidebar>
    <main class="flex-grow-1 p-4 bg-light">
      <h2 class="mb-4">User Management</h2>
      <div class="card">
        <div class="card-header">All Users ({{ users.length || 0 }})</div>
        <div class="card-body">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of paginatedUsers">
                <td>{{ user._id }}</td>
                <td>
                  {{ user.firstName }}
                  {{ user.middleName ? user.middleName + " " : ""
                  }}{{ user.lastName }}
                </td>
                <td>{{ user.email }}</td>
                <td>
                  <span
                    class="badge"
                    [ngClass]="{
                      'bg-danger': user.role === 'admin',
                      'bg-info': user.role === 'owner',
                      'bg-primary': user.role === 'renter'
                    }"
                  >
                    {{ user.role | titlecase }}
                  </span>
                </td>
                <td>
                  <button
                    class="btn btn-warning btn-sm me-2"
                    [routerLink]="['/admin/edit-user', user._id]"
                  >
                    Edit
                  </button>
                  <button
                    class="btn btn-danger btn-sm"
                    (click)="deleteUser(user._id)"
                  >
                    Delete
                  </button>
                </td>
              </tr>
              <tr *ngIf="paginatedUsers.length === 0">
                <td colspan="5" class="text-center text-muted">
                  No users found
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Pagination -->
          <nav aria-label="Users pagination" *ngIf="totalPages > 1">
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  href="#"
                  >Previous</a
                >
              </li>
              <li
                class="page-item"
                *ngFor="let page of [].constructor(totalPages); let i = index"
                [class.active]="currentPage === i + 1"
              >
                <a class="page-link" (click)="changePage(i + 1)" href="#">{{
                  i + 1
                }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPages"
              >
                <a
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  href="#"
                  >Next</a
                >
              </li>
            </ul>
          </nav>

          <!-- Loading Spinner -->
          <div *ngIf="loading" class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading users...</p>
          </div>

          <!-- Error Message -->
          <div *ngIf="error" class="alert alert-danger mt-4" role="alert">
            {{ error }}
            <button
              type="button"
              class="btn-close"
              (click)="error = null"
            ></button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

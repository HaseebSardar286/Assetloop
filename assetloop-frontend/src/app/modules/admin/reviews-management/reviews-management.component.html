<div class="d-flex flex-column vh-100">
  <app-header (logout)="onLogout()"></app-header>
  <div class="d-flex flex-grow-1">
    <app-admin-sidebar></app-admin-sidebar>
    <main class="flex-grow-1 p-4 bg-light">
      <h2 class="mb-4">Reviews Management</h2>
      <!-- Search Card -->
      <div class="card mb-4">
        <div class="card-header">Search Reviews</div>
        <div class="card-body">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              placeholder="Search by reviewer, listing, or comment..."
              [(ngModel)]="searchTerm"
              (input)="searchReviews()"
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              (click)="clearSearch()"
            >
              Clear
            </button>
          </div>
        </div>
      </div>
      <!-- Reviews Card -->
      <div class="card">
        <div class="card-header">
          All Reviews ({{ filteredReviews.length || 0 }})
        </div>
        <div class="card-body">
          <!-- Loading Spinner -->
          <div *ngIf="loading" class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading reviews...</p>
          </div>
          <!-- Reviews Table -->
          <table class="table table-striped" *ngIf="!loading">
            <thead>
              <tr>
                <th>ID</th>
                <th>Reviewer</th>
                <th>Listing/User</th>
                <th>Rating</th>
                <th>Comment</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let review of displayedReviews">
                <td>{{ review._id }}</td>
                <td>
                  {{ review.renter.firstName }} {{ review.renter.lastName }}
                </td>
                <td>
                  {{ review.rental.name || "N/A" }}
                  <ng-container *ngIf="review.owner">
                    ({{ review.owner.firstName }} {{ review.owner.lastName }})
                  </ng-container>
                </td>
                <td>{{ review.rating || "N/A" }} â˜…</td>
                <td>{{ review.comment || "No comment" }}</td>
                <td>{{ (review.createdAt | date : "short") || "N/A" }}</td>
                <td>
                  <button
                    class="btn btn-info btn-sm me-2"
                    [routerLink]="['/admin/view-review', review._id]"
                  >
                    View
                  </button>
                  <button
                    class="btn btn-warning btn-sm me-2"
                    [routerLink]="['/admin/edit-review', review._id]"
                  >
                    Edit
                  </button>
                  <button
                    class="btn btn-danger btn-sm"
                    (click)="deleteReview(review._id)"
                  >
                    Delete
                  </button>
                </td>
              </tr>
              <tr *ngIf="displayedReviews.length === 0">
                <td colspan="7" class="text-center text-muted">
                  No reviews found
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Pagination -->
          <nav
            aria-label="Reviews pagination"
            *ngIf="totalPages > 1 && !loading && !error"
          >
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  href="#"
                  >Previous</a
                >
              </li>
              <li
                class="page-item"
                *ngFor="let page of [].constructor(totalPages); let i = index"
                [class.active]="currentPage === i + 1"
              >
                <a class="page-link" (click)="changePage(i + 1)" href="#">{{
                  i + 1
                }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPages"
              >
                <a
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  href="#"
                  >Next</a
                >
              </li>
            </ul>
          </nav>
          <!-- Error Message -->
          <!-- <div *ngIf="error" class="alert alert-danger mt-4" role="alert">
            {{ error }}
            <button
              type="button"
              class="btn-close"
              (click)="error = null"
            ></button>
          </div> -->
        </div>
      </div>
    </main>
  </div>
</div>

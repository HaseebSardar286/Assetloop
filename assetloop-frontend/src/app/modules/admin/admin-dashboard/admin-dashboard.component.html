<div class="d-flex flex-column vh-100">
  <app-header (logout)="onLogout()"></app-header>
  <div class="d-flex flex-grow-1">
    <app-admin-sidebar></app-admin-sidebar>
    <main class="flex-grow-1 bg-light">
      <section class="dashboard-hero gradient-bg px-4 py-4 py-md-5">
        <div class="container-fluid d-flex flex-wrap justify-content-between align-items-start gap-3">
          <div>
            <div class="badge text-bg-light fw-semibold mb-2">Admin dashboard</div>
            <h2 class="text-white fw-bold mb-1">Welcome back</h2>
            <p class="text-white-50 mb-0">
              Oversee users, assets, bookings, and reviews with quick actions.
            </p>
          </div>
          <div class="stat-pill bg-white shadow-sm rounded-4 p-3 d-flex align-items-center gap-3">
            <div>
              <div class="text-muted small">Total users</div>
              <div class="fs-4 fw-bold text-dark">{{ metrics.totalUsers }}</div>
            </div>
            <div class="vr"></div>
            <div>
              <div class="text-muted small">Bookings</div>
              <div class="fw-semibold text-dark">{{ metrics.totalBookings }}</div>
            </div>
          </div>
        </div>
      </section>

      <section class="container-fluid py-4">
        <div class="row g-3 mb-4">
          <div class="col-sm-6 col-lg-3">
            <div class="metric-card">
              <div class="icon-circle text-primary bg-primary-subtle">
                <fa-icon [icon]="faUsers"></fa-icon>
              </div>
              <div>
                <div class="text-muted small">Users</div>
                <div class="h4 mb-0 fw-bold">{{ metrics.totalUsers }}</div>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-lg-3">
            <div class="metric-card">
              <div class="icon-circle text-success bg-success-subtle">
                <fa-icon [icon]="faBox"></fa-icon>
              </div>
              <div>
                <div class="text-muted small">Assets</div>
                <div class="h4 mb-0 fw-bold">{{ metrics.totalAssets }}</div>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-lg-3">
            <div class="metric-card">
              <div class="icon-circle text-warning bg-warning-subtle">
                <fa-icon [icon]="faComments"></fa-icon>
              </div>
              <div>
                <div class="text-muted small">Reviews</div>
                <div class="h4 mb-0 fw-bold">{{ metrics.totalReviews }}</div>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-lg-3">
            <div class="metric-card">
              <div class="icon-circle text-info bg-info-subtle">
                <fa-icon [icon]="faClipboardList"></fa-icon>
              </div>
              <div>
                <div class="text-muted small">Bookings</div>
                <div class="h4 mb-0 fw-bold">{{ metrics.totalBookings }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- User Management -->
        <div class="card glass-card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
            <h5 class="mb-0">User management</h5>
            <span class="badge bg-white text-primary">{{ users.length }}</span>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6 col-lg-4" *ngFor="let user of paginatedUsers">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                      <h6 class="mb-0">
                        {{ user.firstName }} {{ user?.middleName }} {{ user.lastName }}
                        <span class="badge bg-info ms-2">{{ user.role }}</span>
                      </h6>
                      <button
                        class="btn btn-icon btn-outline-primary"
                        [routerLink]="['/admin/users', user._id]"
                        aria-label="View user"
                      >
                        <fa-icon [icon]="faEye"></fa-icon>
                      </button>
                    </div>
                    <p class="card-text small mb-1"><strong>Email:</strong> {{ user.email }}</p>
                    <p class="card-text small text-muted mb-0">
                      Joined: {{ user.createdAt | date : "mediumDate" }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <p class="text-muted" *ngIf="paginatedUsers.length === 0">No users found.</p>
            <nav aria-label="Users pagination">
              <ul class="pagination justify-content-center mt-3">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <button class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous page">
                    <fa-icon [icon]="faArrowLeft"></fa-icon>
                  </button>
                </li>
                <li
                  class="page-item"
                  *ngFor="let page of [].constructor(totalPagesUsers); let i = index"
                  [class.active]="currentPage === i + 1"
                >
                  <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPagesUsers">
                  <button class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next page">
                    <fa-icon [icon]="faArrowRight"></fa-icon>
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- Asset Management -->
        <div class="card glass-card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center bg-success text-white">
            <h5 class="mb-0">Asset management</h5>
            <span class="badge bg-white text-success">{{ assets.length }}</span>
          </div>
          <div class="card-body">
            <div class="row g-3" *ngIf="paginatedAssets.length > 0">
              <div class="col-md-6 col-lg-4" *ngFor="let asset of paginatedAssets">
                <div class="card h-100 border-0 shadow-sm">
                  <img
                    [src]="asset.images[0]"
                    class="card-img-top"
                    alt="{{ asset.name }}"
                    *ngIf="asset.images && asset.images.length > 0"
                  />
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                      <h6 class="card-title mb-0">{{ asset.name }}</h6>
                      <button
                        class="btn btn-icon btn-outline-success"
                        [routerLink]="['/admin/assets', asset._id]"
                        aria-label="View asset"
                      >
                        <fa-icon [icon]="faEye"></fa-icon>
                      </button>
                    </div>
                    <p class="card-text small text-muted mb-2">{{ asset.description }}</p>
                    <p class="card-text small mb-0">
                      <strong>Price:</strong> PKR {{ asset.price }} / night
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <p class="text-muted" *ngIf="paginatedAssets.length === 0">No assets found.</p>
            <nav aria-label="Assets pagination">
              <ul class="pagination justify-content-center mt-3">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <button class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous page">
                    <fa-icon [icon]="faArrowLeft"></fa-icon>
                  </button>
                </li>
                <li
                  class="page-item"
                  *ngFor="let page of [].constructor(totalPagesAssets); let i = index"
                  [class.active]="currentPage === i + 1"
                >
                  <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPagesAssets">
                  <button class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next page">
                    <fa-icon [icon]="faArrowRight"></fa-icon>
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- Booking Management -->
        <div class="card glass-card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center bg-info text-white">
            <h5 class="mb-0">Booking management</h5>
            <span class="badge bg-white text-info">{{ bookings.length }}</span>
          </div>
          <div class="card-body">
            <div class="row g-3" *ngIf="paginatedBookings.length > 0">
              <div class="col-md-6 col-lg-4" *ngFor="let booking of paginatedBookings">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                      <h6 class="card-title mb-0">{{ booking.name }}</h6>
                      <button
                        class="btn btn-icon btn-outline-info"
                        [routerLink]="['/admin/bookings', booking._id]"
                        aria-label="View booking"
                      >
                        <fa-icon [icon]="faEye"></fa-icon>
                      </button>
                    </div>
                    <p class="card-text small text-muted mb-1">{{ booking.address }}</p>
                    <p class="card-text small mb-1">
                      <strong>Owner:</strong> {{ booking.owner.firstName }} {{ booking.owner.lastName }}
                    </p>
                    <p class="card-text small mb-1">
                      <strong>Renter:</strong> {{ booking.renter?.firstName }} {{ booking.renter?.lastName }}
                    </p>
                    <p class="card-text small mb-0">
                      <strong>Status:</strong>
                      <span
                        class="badge"
                        [ngClass]="{
                          'bg-success': booking.status === 'confirmed',
                          'bg-warning': booking.status === 'pending',
                          'bg-danger': booking.status === 'cancelled'
                        }"
                      >
                        {{ booking.status }}
                      </span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <p class="text-muted" *ngIf="paginatedBookings.length === 0">No bookings found.</p>
            <nav aria-label="Bookings pagination">
              <ul class="pagination justify-content-center mt-3">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <button class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous page">
                    <fa-icon [icon]="faArrowLeft"></fa-icon>
                  </button>
                </li>
                <li
                  class="page-item"
                  *ngFor="let page of [].constructor(totalPagesBookings); let i = index"
                  [class.active]="currentPage === i + 1"
                >
                  <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPagesBookings">
                  <button class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next page">
                    <fa-icon [icon]="faArrowRight"></fa-icon>
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- Review Management -->
        <div class="card glass-card">
          <div class="card-header d-flex justify-content-between align-items-center bg-warning text-white">
            <h5 class="mb-0">Review management</h5>
            <span class="badge bg-white text-warning">{{ reviews.length }}</span>
          </div>
          <div class="card-body">
            <div class="row g-3" *ngIf="paginatedReviews.length > 0">
              <div class="col-md-6 col-lg-4" *ngFor="let review of paginatedReviews">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                      <h6 class="card-title mb-0">{{ review.rental.name || "N/A" }}</h6>
                      <div class="d-flex gap-2">
                        <button
                          class="btn btn-icon btn-outline-warning"
                          [routerLink]="['/admin/reviews', review._id]"
                          aria-label="View review"
                        >
                          <fa-icon [icon]="faEye"></fa-icon>
                        </button>
                        <button
                          class="btn btn-icon btn-outline-danger"
                          (click)="deleteReview(review._id)"
                          aria-label="Delete review"
                        >
                          <fa-icon [icon]="faTrash"></fa-icon>
                        </button>
                      </div>
                    </div>
                    <p class="card-text small mb-1">
                      <strong>Renter:</strong> {{ review.renter.firstName }} {{ review.renter.lastName }}
                    </p>
                    <p class="card-text small mb-1">
                      <strong>Owner:</strong> {{ review.owner?.firstName }} {{ review.owner?.lastName || "N/A" }}
                    </p>
                    <p class="card-text small mb-0">
                      <strong>Rating:</strong> {{ review.rating }}/5<br />
                      <strong>Comment:</strong> {{ review.comment || "No comment" }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <p class="text-muted" *ngIf="paginatedReviews.length === 0">No reviews found.</p>
            <nav aria-label="Reviews pagination">
              <ul class="pagination justify-content-center mt-3">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <button class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous page">
                    <fa-icon [icon]="faArrowLeft"></fa-icon>
                  </button>
                </li>
                <li
                  class="page-item"
                  *ngFor="let page of [].constructor(totalPagesReviews); let i = index"
                  [class.active]="currentPage === i + 1"
                >
                  <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPagesReviews">
                  <button class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next page">
                    <fa-icon [icon]="faArrowRight"></fa-icon>
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- Loading Spinner -->
        <div *ngIf="loading" class="text-center mt-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Loading dashboard data...</p>
        </div>

        <!-- Error Message -->
        <div *ngIf="error" class="alert alert-danger mt-4" role="alert">
          {{ error }}
          <button type="button" class="btn-close" (click)="error = null"></button>
        </div>
      </section>
    </main>
  </div>
</div>

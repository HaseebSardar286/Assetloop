<div class="d-flex flex-column vh-100">
  <app-header (logout)="onLogout()"></app-header>
  <div class="d-flex flex-grow-1">
    <app-admin-sidebar></app-admin-sidebar>
    <main class="flex-grow-1 p-4 bg-light">
      <!-- Welcome & Quick Stats -->
      <div class="mb-4">
        <h2 class="mb-3">ðŸ‘‹ Welcome back, {{ adminName }}!</h2>
        <div class="row g-3">
          <div class="col-md-3">
            <div class="card h-100 bg-primary text-white">
              <div class="card-body text-center">
                <h6 class="card-title">Total Users</h6>
                <p class="display-6 mb-0">{{ metrics.totalUsers }}</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card h-100 bg-success text-white">
              <div class="card-body text-center">
                <h6 class="card-title">Total Assets</h6>
                <p class="display-6 mb-0">{{ metrics.totalAssets }}</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card h-100 bg-warning text-white">
              <div class="card-body text-center">
                <h6 class="card-title">Total Reviews</h6>
                <p class="display-6 mb-0">{{ metrics.totalReviews }}</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card h-100 bg-info text-white">
              <div class="card-body text-center">
                <h6 class="card-title">Total Bookings</h6>
                <p class="display-6 mb-0">{{ metrics.totalBookings }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Management -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">User Management</h4>
        </div>
        <div class="card-body">
          <h5 class="mb-3">Recent Users</h5>
          <div class="row g-3">
            <div class="col-md-6 col-lg-4" *ngFor="let user of users">
              <div class="card h-100 border" *ngIf="user.createdAt">
                <div class="card-body">
                  <h6 class="card-title">
                    {{ user.firstName }} {{ user.lastName }}
                  </h6>
                  <p class="card-text">
                    <strong>Email:</strong> {{ user.email }}<br />
                    <small class="text-muted"
                      >Joined: {{ user.createdAt | date : "mediumDate" }}</small
                    >
                  </p>
                  <button
                    class="btn btn-sm btn-outline-primary"
                    [routerLink]="['/admin/users', user._id]"
                  >
                    View Details
                  </button>
                </div>
              </div>
            </div>
          </div>
          <p class="text-muted" *ngIf="paginatedUsers.length === 0">
            No users found.
          </p>
          <!-- Pagination -->
          <nav aria-label="Users pagination">
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  href="#"
                  >Previous</a
                >
              </li>
              <li
                class="page-item"
                *ngFor="
                  let page of [].constructor(totalPagesUsers);
                  let i = index
                "
                [class.active]="currentPage === i + 1"
              >
                <a class="page-link" (click)="changePage(i + 1)" href="#">{{
                  i + 1
                }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPagesUsers"
              >
                <a
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  href="#"
                  >Next</a
                >
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Asset Management -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-success text-white">
          <h4 class="mb-0">Asset Management</h4>
        </div>
        <div class="card-body">
          <h5 class="mb-3">Recent Assets</h5>
          <div class="row g-3" *ngIf="paginatedAssets.length > 0">
            <div
              class="col-md-6 col-lg-4"
              *ngFor="let asset of paginatedAssets"
            >
              <div class="card h-100 border">
                <img
                  [src]="asset.images[0]"
                  class="card-img-top"
                  alt="{{ asset.name }}"
                  *ngIf="asset.images && asset.images.length > 0"
                />
                <div class="card-body">
                  <h6 class="card-title">{{ asset.name }}</h6>
                  <p class="card-text">{{ asset.description }}</p>
                  <p class="card-text">
                    <strong>Price:</strong> PKR {{ asset.price }} / night
                  </p>
                  <button
                    class="btn btn-sm btn-outline-success"
                    [routerLink]="['/admin/assets', asset._id]"
                  >
                    View Details
                  </button>
                </div>
              </div>
            </div>
          </div>
          <p class="text-muted" *ngIf="paginatedAssets.length === 0">
            No assets found.
          </p>
          <!-- Pagination -->
          <nav aria-label="Assets pagination">
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  href="#"
                  >Previous</a
                >
              </li>
              <li
                class="page-item"
                *ngFor="
                  let page of [].constructor(totalPagesAssets);
                  let i = index
                "
                [class.active]="currentPage === i + 1"
              >
                <a class="page-link" (click)="changePage(i + 1)" href="#">{{
                  i + 1
                }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPagesAssets"
              >
                <a
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  href="#"
                  >Next</a
                >
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Booking Management -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-info text-white">
          <h4 class="mb-0">Booking Management</h4>
        </div>
        <div class="card-body">
          <h5 class="mb-3">All Bookings</h5>
          <div class="row g-3" *ngIf="paginatedBookings.length > 0">
            <div
              class="col-md-6 col-lg-4"
              *ngFor="let booking of paginatedBookings"
            >
              <div class="card h-100 border">
                <div class="card-body">
                  <h6 class="card-title">{{ booking.name }}</h6>
                  <p class="card-text">{{ booking.address }}</p>
                  <p class="card-text">
                    <strong>Owner:</strong> {{ booking.owner.firstName }}
                    {{ booking.owner.lastName }}<br />
                    <small class="text-muted">{{ booking.owner.email }}</small>
                  </p>
                  <p class="card-text">
                    <strong>Renter:</strong> {{ booking.renter?.firstName }}
                    {{ booking.renter?.lastName }}<br />
                    <small class="text-muted">{{
                      booking.renter?.email
                    }}</small>
                  </p>
                  <p class="card-text">
                    <strong>Status:</strong>
                    <span
                      class="badge me-1"
                      [ngClass]="{
                        'bg-success': booking.status === 'confirmed',
                        'bg-warning': booking.status === 'pending',
                        'bg-danger': booking.status === 'cancelled'
                      }"
                      >{{ booking.status }}</span
                    >
                  </p>
                  <button
                    class="btn btn-sm btn-outline-info"
                    [routerLink]="['/admin/bookings', booking._id]"
                  >
                    View Details
                  </button>
                </div>
              </div>
            </div>
          </div>
          <p class="text-muted" *ngIf="paginatedBookings.length === 0">
            No bookings found.
          </p>
          <!-- Pagination -->
          <nav aria-label="Bookings pagination">
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  href="#"
                  >Previous</a
                >
              </li>
              <li
                class="page-item"
                *ngFor="
                  let page of [].constructor(totalPagesBookings);
                  let i = index
                "
                [class.active]="currentPage === i + 1"
              >
                <a class="page-link" (click)="changePage(i + 1)" href="#">{{
                  i + 1
                }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPagesBookings"
              >
                <a
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  href="#"
                  >Next</a
                >
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Review Management -->
      <div class="card shadow-sm">
        <div class="card-header bg-warning text-white">
          <h4 class="mb-0">Review Management</h4>
        </div>
        <div class="card-body">
          <h5 class="mb-3">All Reviews</h5>
          <div class="row g-3" *ngIf="paginatedReviews.length > 0">
            <div
              class="col-md-6 col-lg-4"
              *ngFor="let review of paginatedReviews"
            >
              <div class="card h-100 border">
                <div class="card-body">
                  <h6 class="card-title">{{ review.rental.name || "N/A" }}</h6>
                  <p class="card-text">
                    <strong>Renter:</strong> {{ review.renter.firstName }}
                    {{ review.renter.lastName }}<br />
                    <small class="text-muted">{{ review.renter.email }}</small>
                  </p>
                  <p class="card-text">
                    <strong>Owner:</strong> {{ review.owner?.firstName }}
                    {{ review.owner?.lastName || "N/A" }}<br />
                    <small class="text-muted">{{
                      review.owner?.email || "N/A"
                    }}</small>
                  </p>
                  <p class="card-text">
                    <strong>Rating:</strong> {{ review.rating }}/5<br />
                    <strong>Comment:</strong>
                    {{ review.comment || "No comment" }}
                  </p>
                  <button
                    class="btn btn-sm btn-outline-warning"
                    [routerLink]="['/admin/reviews', review._id]"
                  >
                    View Details
                  </button>
                  <button
                    class="btn btn-sm btn-outline-danger ms-2"
                    (click)="deleteReview(review._id)"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
          <p class="text-muted" *ngIf="paginatedReviews.length === 0">
            No reviews found.
          </p>
          <!-- Pagination -->
          <nav aria-label="Reviews pagination">
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  href="#"
                  >Previous</a
                >
              </li>
              <li
                class="page-item"
                *ngFor="
                  let page of [].constructor(totalPagesReviews);
                  let i = index
                "
                [class.active]="currentPage === i + 1"
              >
                <a class="page-link" (click)="changePage(i + 1)" href="#">{{
                  i + 1
                }}</a>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage === totalPagesReviews"
              >
                <a
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  href="#"
                  >Next</a
                >
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="text-center mt-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading dashboard data...</p>
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="alert alert-danger mt-4" role="alert">
        {{ error }}
        <button type="button" class="btn-close" (click)="error = null"></button>
      </div>
    </main>
  </div>
</div>

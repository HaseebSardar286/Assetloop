<div class="d-flex flex-column vh-100">
  <app-header (logout)="onLogout()"></app-header>
  <div class="d-flex flex-grow-1">
    <app-admin-sidebar></app-admin-sidebar>
    <main class="flex-grow-1 p-4 bg-light">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">User Details</h2>
        <a
          class="btn btn-outline-secondary"
          [routerLink]="['/admin/manage-users']"
        >
          <i class="bi bi-arrow-left"></i> Back to Users
        </a>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="text-center mt-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading user details...</p>
      </div>

      <!-- Error State -->
      <div
        *ngIf="error"
        class="alert alert-danger d-flex justify-content-between"
        role="alert"
      >
        <span>{{ error }}</span>
        <button type="button" class="btn-close" (click)="error = null"></button>
      </div>

      <!-- Content -->
      <div *ngIf="user && !loading" class="row g-4">
        <!-- Profile Card -->
        <div class="col-md-4">
          <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
              <div class="mb-3">
                <div
                  class="rounded-circle bg-secondary-subtle d-inline-flex align-items-center justify-content-center"
                  style="width: 120px; height: 120px; font-size: 48px"
                >
                  {{ user.firstName.charAt(0) || "U" }}
                </div>
              </div>
              <h5 class="mb-1">{{ user.firstName }} {{ user.lastName }}</h5>
              <span class="badge bg-info text-dark">{{
                user.role | titlecase
              }}</span>
              <div class="mt-3 text-muted small">
                <div><i class="bi bi-envelope"></i> {{ user.email }}</div>
                <div *ngIf="user.phoneNumber">
                  <i class="bi bi-telephone"></i> {{ user.phoneNumber }}
                </div>
                <div *ngIf="user.city || user.country">
                  <i class="bi bi-geo-alt"></i>
                  {{ user.city || "—" }}, {{ user.country || "—" }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Details -->
        <div class="col-md-8">
          <div class="card shadow-sm">
            <div class="card-header">
              <h5 class="mb-0">Account Information</h5>
            </div>
            <div class="card-body">
              <div class="row mb-3" *ngIf="summary?.role === 'owner'">
                <div class="col-12">
                  <div class="d-flex gap-3 flex-wrap">
                    <div class="border rounded p-3 bg-white">
                      <div class="text-muted small">Total Assets</div>
                      <div class="fs-5 fw-semibold">
                        {{ summary?.assetsCount || 0 }}
                      </div>
                    </div>
                    <div class="border rounded p-3 bg-white">
                      <div class="text-muted small">Active Assets</div>
                      <div class="fs-5 fw-semibold">
                        {{ summary?.activeAssets || 0 }}
                      </div>
                    </div>
                    <div class="border rounded p-3 bg-white">
                      <div class="text-muted small">Bookings as Owner</div>
                      <div class="fs-5 fw-semibold">
                        {{ summary?.bookingsAsOwner || 0 }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mb-3" *ngIf="summary?.role === 'renter'">
                <div class="col-12">
                  <div class="d-flex gap-3 flex-wrap">
                    <div class="border rounded p-3 bg-white">
                      <div class="text-muted small">Bookings</div>
                      <div class="fs-5 fw-semibold">
                        {{ summary?.bookingsAsRenter || 0 }}
                      </div>
                    </div>
                    <div class="border rounded p-3 bg-white">
                      <div class="text-muted small">Wishlist Items</div>
                      <div class="fs-5 fw-semibold">
                        {{ summary?.wishlistCount || 0 }}
                      </div>
                    </div>
                    <div class="border rounded p-3 bg-white">
                      <div class="text-muted small">Cart Items</div>
                      <div class="fs-5 fw-semibold">
                        {{ summary?.cartCount || 0 }}
                      </div>
                    </div>
                    <div class="border rounded p-3 bg-white">
                      <div class="text-muted small">Total Spent</div>
                      <div class="fs-5 fw-semibold">
                        {{
                          summary?.totalSpent || 0 | currency : "USD" : "symbol"
                        }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-sm-4"><strong>First Name</strong></div>
                <div class="col-sm-8">{{ user.firstName || "—" }}</div>
              </div>
              <div class="row mb-3" *ngIf="user.middleName">
                <div class="col-sm-4"><strong>Middle Name</strong></div>
                <div class="col-sm-8">{{ user.middleName }}</div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-4"><strong>Last Name</strong></div>
                <div class="col-sm-8">{{ user.lastName || "—" }}</div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-4"><strong>Address</strong></div>
                <div class="col-sm-8">{{ user.address || "—" }}</div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-4"><strong>Verification Status</strong></div>
                <div class="col-sm-8">
                  <span
                    class="badge"
                    [ngClass]="{
                      'bg-warning': user.verificationStatus === 'pending',
                      'bg-success': user.verificationStatus === 'approved',
                      'bg-danger': user.verificationStatus === 'rejected'
                    }"
                    >{{ user.verificationStatus | titlecase }}</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

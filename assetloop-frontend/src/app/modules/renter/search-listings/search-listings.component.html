<div class="d-flex flex-column vh-100">
  <app-header (logout)="logout()"></app-header>
  <div class="d-flex flex-grow-1">
    <app-renter-side-bar (logout)="logout()"></app-renter-side-bar>
    <main class="flex-grow-1 p-4 bg-light">
      <h2 class="mb-4">Search Results</h2>
      <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
      <div class="row">
        <div class="col-md-3">
          <div class="card p-3 mb-4">
            <h5>Filters</h5>
            <form [formGroup]="searchForm">
              <div class="mb-3">
                <label>Keywords</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="keywords"
                  placeholder="Keywords..."
                />
              </div>
              <div class="mb-3">
                <label>Category</label>
                <select class="form-select" formControlName="category">
                  <option>All Categories</option>
                  <option>Car</option>
                  <option>Apartment</option>
                  <option>House</option>
                  <option>Tool</option>
                </select>
              </div>
              <div class="mb-3">
                <label>Price Range (per night)</label>
                <div class="row">
                  <div class="col">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="minPrice"
                      placeholder="Min"
                    />
                  </div>
                  <div class="col">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="maxPrice"
                      placeholder="Max"
                    />
                  </div>
                </div>
              </div>
              <button
                type="button"
                class="btn btn-primary w-100 mb-2"
                (click)="applyFilters()"
              >
                Apply Filters
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary w-100"
                (click)="clearFilters()"
              >
                Clear Filters
              </button>
            </form>
          </div>
        </div>
        <div class="col-md-9">
          <div class="d-flex justify-content-between mb-3">
            <p>
              <strong>{{ filteredAssets.length }} listings found</strong>
            </p>
            <select class="form-select w-auto" (change)="changeSort($event)">
              <option value="recommended">Sort by: Recommended</option>
              <option value="priceLowToHigh">Price: Low to High</option>
              <option value="priceHighToLow">Price: High to Low</option>
            </select>
          </div>
          <div class="row g-4">
            <div class="col-md-4" *ngFor="let asset of displayedAssets">
              <app-product-item
                [asset]="asset"
                [isFavourite]="false"
                (viewListing)="viewDetails($event)"
                (addToCart)="addToCart(asset)"
                (removeFavourite)="addToFavourites(asset._id)"
                (share)="share($event)"
                (updateNotes)="updateNotes($event)"
              ></app-product-item>
            </div>
          </div>
          <div
            class="d-flex justify-content-center mt-4"
            *ngIf="pagination.totalPages > 1"
          >
            <nav>
              <ul class="pagination">
                <li class="page-item" [class.disabled]="pagination.page === 1">
                  <button
                    class="page-link"
                    (click)="changePage(pagination.page - 1)"
                  >
                    Previous
                  </button>
                </li>
                <li
                  class="page-item"
                  *ngFor="
                    let page of [].constructor(pagination.totalPages);
                    let i = index
                  "
                  [class.active]="pagination.page === i + 1"
                >
                  <button class="page-link" (click)="changePage(i + 1)">
                    {{ i + 1 }}
                  </button>
                </li>
                <li
                  class="page-item"
                  [class.disabled]="pagination.page === pagination.totalPages"
                >
                  <button
                    class="page-link"
                    (click)="changePage(pagination.page + 1)"
                  >
                    Next
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
